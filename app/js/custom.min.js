/*!
 * RaspAP - RaspAP WiFi Configuration Portal v1.6.1 (https://github.com/billz/raspap-webgui)
 * Copyright 2013-2019 RaspAP Developers
 * Licensed under MIT (https://github.com/raspap-webgui/raspap-webgui/blob/master/LICENSE)
 */
 
function msgShow(t,e){if(0==t)var a="success";else if(2==t||1==t)a="danger";return'<div class="alert alert-'+a+' alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+e+"</div>"}function createNetmaskAddr(t){var e=[];for(i=0;i<4;i++){var a=Math.min(t,8);e.push(256-Math.pow(2,8-a)),t-=a}return e.join(".")}function loadSummary(t){$.post("ajax/networking/get_ip_summary.php",{interface:t},function(e){jsonData=JSON.parse(e),console.log(jsonData),0==jsonData.return?$("#"+t+"-summary").html(jsonData.output.join("<br />")):2==jsonData.return&&$("#"+t+"-summary").append('<div class="alert alert-danger alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+jsonData.output.join("<br />")+"</div>")})}function getAllInterfaces(){$.get("ajax/networking/get_all_interfaces.php",function(t){jsonData=JSON.parse(t),$.each(jsonData,function(t,e){loadSummary(e)})})}function setupTabs(){$('a[data-toggle="tab"]').on("shown.bs.tab",function(t){var e=$(t.target).attr("href");e.match("summary")||loadCurrentSettings(e.replace("#",""))})}function loadCurrentSettings(t){$.post("ajax/networking/get_int_config.php",{interface:t},function(t){jsonData=JSON.parse(t),$.each(jsonData.output,function(t,e){var a=e.interface;$.each(e,function(t,e){switch(t){case"static":"true"==e?($("#"+a+"-static").click(),$("#"+a+"-nofailover").click()):$("#"+a+"-dhcp").click();break;case"failover":"true"===e?$("#"+a+"-failover").click():$("#"+a+"-nofailover").click();break;case"ip_address":var n=e.split("/");$("#"+a+"-ipaddress").val(n[0]),$("#"+a+"-netmask").val(createNetmaskAddr(n[1]));break;case"routers":$("#"+a+"-gateway").val(e);break;case"domain_name_server":svrsDNS=e.split(" "),$("#"+a+"-dnssvr").val(svrsDNS[0]),$("#"+a+"-dnssvralt").val(svrsDNS[1])}})})})}function saveNetworkSettings(t,e=""){var a=$("#frm-"+t).find(":input"),n={};$.each(a,function(t,e){"radio"==$(e).attr("type")?n[$(e).attr("id")]=$(e).prop("checked"):n[$(e).attr("id")]=$(e).val()}),n.interface=t,n.opts=e,$.post("ajax/networking/save_int_config.php",n,function(t){var e=JSON.parse(t);$("#msgNetworking").html(msgShow(e.return,e.output))})}function applyNetworkSettings(){$(this).data("int");arrFormData={},arrFormData.generate="",$.post("ajax/networking/gen_int_config.php",arrFormData,function(t){var e=JSON.parse(t);$("#msgNetworking").html(msgShow(e.return,e.output))})}function genPassword(t){return Array(t).fill("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz").map(function(t){return t[Math.floor(Math.random()*t.length)]}).join("")}function setupBtns(){$("#btnSummaryRefresh").click(function(){getAllInterfaces()}),$(".intsave").click(function(){saveNetworkSettings($(this).data("int"),$(this).data("opts"))}),$(".intapply").click(function(){applyNetworkSettings()})}function setCSRFTokenHeader(t,e,a){var n=$("meta[name=csrf_token]").attr("content");/^(POST|PATCH|PUT|DELETE)$/i.test(a.type)&&e.setRequestHeader("X-CSRF-Token",n)}function contentLoaded(){switch(pageCurrent=window.location.href.split("?")[1].split("=")[1],pageCurrent=pageCurrent.replace("#",""),pageCurrent){case"network_conf":getAllInterfaces(),setupTabs(),setupBtns();case"hostapd_conf":loadChannel()}}function loadWifiStations(t){return function(){var e=!0===t?"?refresh":"";$(".js-wifi-stations").addClass("loading-spinner").empty().load("ajax/networking/wifi_stations.php"+e,function(){$(this).removeClass("loading-spinner")})}}function loadChannel(){$.get("ajax/networking/get_channel.php",function(t){jsonData=JSON.parse(t),loadChannelSelect(jsonData)})}function loadChannelSelect(t){$.getJSON("config/wireless.json",function(e){var a=$("#cbxhwmode").val(),n=$("#cbxcountries").val(),s=$("#cbxchannel"),o=e.wireless_regdb,r=Array.range(1,14),i=o["2_4GHz_max11ch"].countries,c=o["2_4GHz_max14ch"].countries,l=o["5Ghz_max48ch"].countries;-1!==$.inArray(n,i)&&"ac"!==a?r=o["2_4GHz_max11ch"].channels:-1!==$.inArray(n,c)&&"b"===a?r=o["2_4GHz_max14ch"].channels:-1!==$.inArray(n,l)&&"ac"===a&&(r=o["5Ghz_max48ch"].channels),t=void 0===t?r[0]:t,s.empty(),$.each(r,function(t,e){s.append($("<option></option>").attr("value",e).text(e))}),s.val(t)})}function updateBlocklist(){var t=$("#cbxblocklist").val();""!=t&&($("#cbxblocklist-status").find("i").removeClass("fas fa-check").addClass("fas fa-cog fa-spin"),$("#cbxblocklist-status").removeClass("check-hidden").addClass("check-progress"),$.post("ajax/adblock/update_blocklist.php",{blocklist_id:t},function(e){"0"==JSON.parse(e).return&&($("#cbxblocklist-status").find("i").removeClass("fas fa-cog fa-spin").addClass("fas fa-check"),$("#cbxblocklist-status").removeClass("check-progress").addClass("check-updated").delay(500).animate({opacity:1},700),$("#"+t).text("Just now"))}))}function clearBlocklistStatus(){$("#cbxblocklist-status").removeClass("check-updated").addClass("check-hidden")}function set_theme(t){$('link[title="main"]').attr("href","app/css/"+t),setCookie("theme",t,90)}function setCookie(t,e,a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3);var s="expires="+n.toUTCString();document.cookie=t+"="+e+";"+s+";path=/"}function getCookie(t){var e=new RegExp(t+"=([^;]+)").exec(document.cookie);return null!=e?unescape(e[1]):null}$(document).on("click",".js-add-dhcp-static-lease",function(t){t.preventDefault();var e=$(".js-new-dhcp-static-lease"),a=$("input[name=mac]",e).val().trim(),n=$("input[name=ip]",e).val().trim();if(""!=a&&""!=n){var s=$("#js-dhcp-static-lease-row").html().replace("{{ mac }}",a).replace("{{ ip }}",n);$(".js-dhcp-static-lease-container").append(s),$("input[name=mac]",e).val(""),$("input[name=ip]",e).val("")}}),$(document).on("click",".js-remove-dhcp-static-lease",function(t){t.preventDefault(),$(this).parents(".js-dhcp-static-lease-row").remove()}),$(document).on("submit",".js-dhcp-settings-form",function(t){$(".js-add-dhcp-static-lease").trigger("click")}),$(document).on("click",".js-add-dhcp-upstream-server",function(t){t.preventDefault();var e=$("#add-dhcp-upstream-server-field"),a=$("#dhcp-upstream-server").html().replace("{{ server }}",e.val());""!=e.val().trim()&&($(".js-dhcp-upstream-servers").append(a),e.val(""))}),$(document).on("click",".js-remove-dhcp-upstream-server",function(t){t.preventDefault(),$(this).parents(".js-dhcp-upstream-server").remove()}),$(document).on("submit",".js-dhcp-settings-form",function(t){$(".js-add-dhcp-upstream-server").trigger("click")}),$(document).on("change",".js-field-preset",function(t){var e=this.getAttribute("data-field-preset-target"),a=""+this.value;""!==a.trim()&&document.querySelectorAll(e).forEach(function(t){t.value=a})}),$(document).on("click","#gen_wpa_passphrase",function(t){$("#txtwpapassphrase").val(genPassword(63))}),$(".js-reload-wifi-stations").on("click",loadWifiStations(!0)),Array.range=((t,e)=>Array.from({length:e-t},(e,a)=>a+t)),$(document).on("click",".js-toggle-password",function(t){var e=$(t.target),a=$(e.data("target"));a.is(":input")&&(t.preventDefault(),e.data("__toggle-with-initial")||e.data("__toggle-with-initial",e.text()),"password"===a.attr("type")?(e.text(e.data("toggle-with")),a.attr("type","text")):(e.text(e.data("__toggle-with-initial")),a.attr("type","password")))}),$(document).on("keyup",".js-validate-psk",function(t){var e=$(t.target),a=e.data("colors").split(","),n=$(e.data("target"));e.val().length<8||e.val().length>63?(e.css("backgroundColor",a[0]),n.attr("disabled",!0)):(e.css("backgroundColor",a[1]),n.attr("disabled",!1))}),$(function(){$("#theme-select").change(function(){set_theme(themes[$("#theme-select").val()])})});var themes={default:"custom.php",hackernews:"hackernews.css",lightsout:"lightsout.css"};$("#sidebarToggleTopbar").on("click",function(t){$("body").toggleClass("sidebar-toggled"),$(".sidebar").toggleClass("toggled d-none")}),$("#sidebarToggle, #sidebarToggleTop").on("click",function(t){setCookie("sidebarToggled",$(".sidebar").hasClass("toggled"),90)}),$(function(){$(window).width()<768&&($(".sidebar").addClass("toggled"),setCookie("sidebarToggled",!1,90))}),$(window).on("load resize",function(t){$(window).width()>768&&($(".sidebar").removeClass("d-none d-md-block"),"false"==getCookie("sidebarToggled")&&$(".sidebar").removeClass("toggled"))}),$(window).bind("load",function(){var t=window.location;$("ul.navbar-nav a").filter(function(){return this.href==t}).parent().addClass("active")}),$(document).ajaxSend(setCSRFTokenHeader).ready(contentLoaded).ready(loadWifiStations());